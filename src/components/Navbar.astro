---
import { Cross, Heart, BookOpen, User, Mail } from "lucide-astro";
import { getI18N } from "../i18n/utils";
import { getRelativeLocaleUrl } from "astro:i18n";

const { currentLocale } = Astro;
const i18n = getI18N({ currentLocale });
const currentPath = Astro.url.pathname;
const pathWithoutLocale = currentPath.replace(/^\/(en|es)/, "") || "/";

const homeLink = getRelativeLocaleUrl(currentLocale, "/");
const blogLink = getRelativeLocaleUrl(currentLocale, "/blog");
const versesLink = getRelativeLocaleUrl(currentLocale, "/bible-verses");
const aboutLink = getRelativeLocaleUrl(currentLocale, "/about");
const contactLink = getRelativeLocaleUrl(currentLocale, "/contact");

// const enUrl = getRelativeLocaleUrl('en', currentPath);
// const esUrl = getRelativeLocaleUrl('es', currentPath);
const enUrl = `/en${pathWithoutLocale}`;
const esUrl = `/es${pathWithoutLocale}`;
---

<nav
  class="bg-white/95 backdrop-blur-sm shadow-lg border-b border-spiritual-100 sticky top-0 z-50"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <div class="flex items-center space-x-2">
        <div class="relative">
          <Cross class="w-8 h-8 text-spiritual-600" />
          <div class="absolute -top-1 -right-1 w-3 h-3">
            <div
              class="w-full h-full bg-gold-400 rounded-full opacity-60 animate-pulse"
            >
            </div>
          </div>
        </div>
        <span class="font-serif text-2xl font-bold text-spiritual-900"
          >Grace & Light</span
        >
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        <a
          href={homeLink}
          class={`flex items-center space-x-1 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath === homeLink ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:text-spiritual-600 hover:bg-spiritual-50"}`}
        >
          <Heart class="w-4 h-4" />
          <span>{i18n["nav.home"]}</span>
        </a>

        <a
          href={blogLink}
          class={`flex items-center space-x-1 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath.startsWith(blogLink) ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:text-spiritual-600 hover:bg-spiritual-50"}`}
        >
          <BookOpen class="w-4 h-4" />
          <span>{i18n["nav.blog"]}</span>
        </a>

        <a
          href={versesLink}
          class={`flex items-center space-x-1 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath.startsWith(versesLink) ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:text-spiritual-600 hover:bg-spiritual-50"}`}
        >
          <BookOpen class="w-4 h-4" />
          <span>{i18n["nav.verses"]}</span>
        </a>

        <a
          href={aboutLink}
          class={`flex items-center space-x-1 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath === aboutLink ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:text-spiritual-600 hover:bg-spiritual-50"}`}
        >
          <User class="w-4 h-4" />
          <span>{i18n["nav.about"]}</span>
        </a>

        <a
          href={contactLink}
          class={`flex items-center space-x-1 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath === contactLink ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:text-spiritual-600 hover:bg-spiritual-50"}`}
        >
          <Mail class="w-4 h-4" />
          <span>{i18n["nav.contact"]}</span>
        </a>
  <!-- Language Switcher -->
<div class="relative group inline-block">
  <button
    class="flex items-center space-x-2 border-l border-gray-200 ml-6 pl-6"
  >
    <span
      class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"
    >
      {currentLocale === "es" ? "Español" : "English"}
    </span>
    <svg
      class="w-4 h-4 text-gray-700"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M19 9l-7 7-7-7"
      />
    </svg>
  </button>

  <!-- Menú desplegable -->
  <div
    class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10"
  >
    <a
      href={enUrl}
      class={`block px-4 py-2 text-sm ${currentLocale === "en" ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:bg-gray-100"}`}
    >
      English
    </a>
    <a
      href={esUrl}
      class={`block px-4 py-2 text-sm ${currentLocale === "es" ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:bg-gray-100"}`}
    >
      Español
    </a>
  </div>
</div>
  <!-- End btn chatgpt -->
        <!-- <div class="relative group">
          <button
            class="flex items-center space-x-2 border-l border-gray-200 ml-6 pl-6"
          >
            <span
              class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"
            >
              {currentLocale === "es" ? "Español" : "English"}
            </span>
            <svg
              class="w-4 h-4 text-gray-700"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div
            class="hidden group-hover:block absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1"
          >
            <a
              href={enUrl}
              class={`block px-4 py-2 text-sm ${currentLocale === "en" ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:bg-gray-100"}`}
            >
              English
            </a>
            <a
              href={esUrl}
              class={`block px-4 py-2 text-sm ${currentLocale === "es" ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700 hover:bg-gray-100"}`}
            >
              Español
            </a>
          </div>
        </div> -->
        <div class="md:hidden flex items-center space-x-1 mr-2">
          <a
            href={enUrl}
            class={`px-2 py-1 rounded-md text-xs font-medium ${currentLocale === "en" ? "text-white bg-spiritual-600" : "text-gray-700 hover:bg-gray-100"}`}
          >
            EN
          </a>
          <a
            href={esUrl}
            class={`px-2 py-1 rounded-md text-xs font-medium ${currentLocale === "es" ? "text-white bg-spiritual-600" : "text-gray-700 hover:bg-gray-100"}`}
          >
            ES
          </a>
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="md:hidden flex items-center">
        <div class="flex items-center space-x-1 mr-2">
          <a
            href={enUrl}
            class={`px-2 py-1 rounded-md text-xs font-medium ${currentLocale === "en" ? "text-white bg-spiritual-600" : "text-gray-700 hover:bg-gray-100"}`}
            >EN</a
          >
          <a
            href={esUrl}
            class={`px-2 py-1 rounded-md text-xs font-medium ${currentLocale === "es" ? "text-white bg-spiritual-600" : "text-gray-700 hover:bg-gray-100"}`}
            >ES</a
          >
        </div>
        <button
          id="mobile-menu-button"
          class="text-gray-700 hover:text-spiritual-600 p-2"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div
      id="mobile-menu"
      class="md:hidden hidden border-t border-spiritual-100 py-4"
    >
      <div class="flex flex-col space-y-2">
        <a
          href={homeLink}
          class={`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath === homeLink ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700"}`}
        >
          <Heart class="w-4 h-4" />
          <span>{i18n["nav.home"]}</span>
        </a>

        <a
          href={blogLink}
          class={`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath.startsWith(blogLink) ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700"}`}
        >
          <BookOpen class="w-4 h-4" />
          <span>{i18n["nav.blog"]}</span>
        </a>

        <a
          href={versesLink}
          class={`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath.startsWith(versesLink) ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700"}`}
        >
          <BookOpen class="w-4 h-4" />
          <span>{i18n["nav.verses"]}</span>
        </a>

        <a
          href={aboutLink}
          class={`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath === aboutLink ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700"}`}
        >
          <User class="w-4 h-4" />
          <span>{i18n["nav.about"]}</span>
        </a>

        <a
          href={contactLink}
          class={`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 ${currentPath === contactLink ? "text-spiritual-600 bg-spiritual-50" : "text-gray-700"}`}
        >
          <Mail class="w-4 h-4" />
          <span>{i18n["nav.contact"]}</span>
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });
</script>
